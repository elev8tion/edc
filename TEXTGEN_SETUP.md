# AI Text Generation Setup Guide

This guide explains how to set up and use the LSTM text generation model in the everyday-christian app.

## Current Status

✅ **Text Generation Service Created** (`lib/services/text_generator_service.dart`)
✅ **Training Script Ready** (`training/train_text_generator.py`)
✅ **Integration Complete** - Integrated into `local_ai_service.dart`

## Quick Start

### Option 1: Use Pre-Trained Model (Coming Soon)
```bash
# Download pre-trained model
# (Will be provided after initial training)
```

### Option 2: Train Your Own Model

1. **Install Python Dependencies**:
```bash
cd training
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

2. **Train the Model** (~1-2 hours):
```bash
python train_text_generator.py
```

This will:
- Download Bible (KJV) text automatically
- Train LSTM model on Christian text
- Convert to TFLite format
- Save to `assets/models/`

3. **Verify Files Created**:
```bash
ls -lh ../assets/models/
# Should see:
# - text_generator.tflite (~20-40MB)
# - char_vocab.txt (~few KB)
```

## How It Works

### 1. Theme Detection (Current)
```dart
ThemeClassifierService  // Detects: anxiety, depression, guidance, etc.
    ↓
TFLite sentiment model (751KB)
    ↓
Theme: "anxiety"
```

### 2. Text Generation (New)
```dart
TextGeneratorService    // Generates Christian responses
    ↓
LSTM TFLite model (~25MB)
    ↓
AI-generated text: "When facing worry, remember that God..."
```

### 3. Combined Flow
```
User Input → Theme Detection → Text Generation → Bible Verses → Response
```

## Features

### Graceful Fallback
- If text generation model isn't available, uses template responses
- App works with or without the model
- Logs help debug which mode is active

### Platform Support
- ✅ iOS (GPU acceleration via Metal)
- ✅ Android (XNNPack optimization)
- Character-level generation for smaller model size

### Performance
- Model load: ~500ms-1s
- Generation: ~2-5s for 200 characters
- Memory: ~50-80MB additional RAM

## Testing

### Check if Text Generator is Active

Look for log messages:
```
✅ Text generator initialized
✅ AI Service initialized with theme classifier + text generation
```

If you see:
```
⚠️ Text generator not available, using templates
✅ AI Service initialized with theme classifier only
```
The model file is missing - run training script.

### Test Generation

```dart
// In your app
final generator = TextGeneratorService.instance;
await generator.initialize();

final text = await generator.generateText(
  prompt: "God ",
  maxLength: 100,
);
print(text);  // Should generate Christian-themed text
```

## Model Customization

### Adjust Model Size

Edit `training/train_text_generator.py`:

```python
# Smaller model (~10MB, faster but lower quality)
RNN_UNITS = 512

# Default (~25MB, balanced)
RNN_UNITS = 1024

# Larger model (~80MB, better quality)
RNN_UNITS = 2048
```

### Train on Custom Text

Add your own training data:

```python
def load_custom_data():
    # Add devotional books, sermons, etc.
    with open('my_christian_texts.txt') as f:
        return f.read()
```

### Adjust Generation Style

In `TextGeneratorService`:

```dart
// More creative (0.8-1.2)
temperature: 1.0,

// More conservative (0.5-0.7)
temperature: 0.6,

// Very deterministic (0.3-0.5)
temperature: 0.4,
```

## Troubleshooting

### Model File Not Found
```
Error: Unable to load text_generator.tflite
```
**Solution**: Run `python train_text_generator.py`

### Poor Quality Generation
```
Generated text is gibberish
```
**Solutions**:
- Train for more epochs (increase EPOCHS in script)
- Use larger model (increase RNN_UNITS)
- Ensure training completed successfully

### Out of Memory
```
App crashes on model load
```
**Solutions**:
- Reduce RNN_UNITS (use 512 instead of 1024)
- Close other apps
- Test on newer devices

## Next Steps

1. ✅ Service created
2. ⏳ **Train model** - Run training script
3. ⏳ **Test in app** - Verify text generation works
4. ⏳ **Fine-tune** - Adjust temperature, model size
5. ⏳ **Deploy** - Include model in production builds

## File Structure

```
everyday-christian/
├── lib/services/
│   ├── text_generator_service.dart  ← New service
│   ├── theme_classifier_service.dart
│   └── local_ai_service.dart        ← Updated to use text gen
├── training/
│   ├── train_text_generator.py      ← Training script
│   ├── requirements.txt
│   └── README.md
└── assets/models/
    ├── text_generator.tflite         ← Generated by training
    ├── char_vocab.txt                ← Generated by training
    ├── text_classification.tflite    ← Existing (theme detection)
    └── vocab                         ← Existing (theme vocab)
```

## Performance Comparison

| Method | Size | Quality | Speed | Offline |
|--------|------|---------|-------|---------|
| Templates (current) | 0MB | Fixed | Instant | ✅ |
| LSTM (new) | ~25MB | Variable | 2-5s | ✅ |
| Cloud API | 0MB | Excellent | 1-3s | ❌ |
| Flutter Gemma | 770MB | Excellent | 5-10s | ✅ |

**LSTM is the sweet spot**: Good quality, offline, reasonable size!
